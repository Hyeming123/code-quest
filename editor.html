<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cì–¸ì–´ ì˜¨ë¼ì¸ ì»´íŒŒì¼ëŸ¬</title>
<link rel="stylesheet" href="styles.css">
<style>
  .user-info {
    position: absolute;
    top: 15px;
    right: 20px;
    color: #4fc3f7;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .logout-btn {
    background-color: #c41e3a;
    padding: 8px 15px;
    font-size: 14px;
    cursor: pointer;
    border: none;
    border-radius: 4px;
    color: white;
    transition: background-color 0.3s;
  }

  .logout-btn:hover {
    background-color: #a01830;
  }

  header {
    position: relative;
  }

  .attendance-dashboard {
    background-color: #252526;
    border: 1px solid #3c3c3c;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
  }

  .attendance-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .attendance-header h3 {
    color: #4fc3f7;
    margin: 0;
  }

  .check-in-btn {
    background-color: #1e5f1e;
    padding: 10px 20px;
    font-size: 14px;
    cursor: pointer;
    border: none;
    border-radius: 4px;
    color: white;
    transition: background-color 0.3s;
  }

  .check-in-btn:hover {
    background-color: #2a7f2a;
  }

  .check-in-btn:disabled {
    background-color: #555555;
    cursor: not-allowed;
  }

  .attendance-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
  }

  .stat-card {
    background-color: #1e1e1e;
    border: 1px solid #3c3c3c;
    border-radius: 4px;
    padding: 15px;
    text-align: center;
  }

  .stat-label {
    color: #888888;
    font-size: 12px;
    margin-bottom: 5px;
  }

  .stat-value {
    color: #4fc3f7;
    font-size: 28px;
    font-weight: bold;
  }

  .attendance-history {
    background-color: #1e1e1e;
    border: 1px solid #3c3c3c;
    border-radius: 4px;
    padding: 15px;
    max-height: 200px;
    overflow-y: auto;
  }

  .attendance-history h4 {
    color: #4fc3f7;
    margin-top: 0;
  }

  .attendance-item {
    padding: 8px;
    border-bottom: 1px solid #3c3c3c;
    font-size: 13px;
    color: #b0b0b0;
  }

  .attendance-item:last-child {
    border-bottom: none;
  }

  .attendance-item .date {
    color: #4fc3f7;
    font-weight: bold;
  }

  .attendance-item .status {
    color: #6bff6b;
    margin-left: 10px;
  }

  .check-in-message {
    padding: 10px;
    border-radius: 4px;
    margin-bottom: 15px;
    display: none;
  }

  .check-in-message.success {
    background-color: #1e5f1e;
    color: #6bff6b;
    display: block;
  }

  .check-in-message.info {
    background-color: #1e3a5f;
    color: #4fc3f7;
    display: block;
  }

  #output {
    background-color: #0d0d0d;
    border: 1px solid #3c3c3c;
    padding: 15px;
    border-radius: 4px;
    min-height: 150px;
    max-height: 400px;
    overflow-y: auto;
    font-size: 14px;
    line-height: 1.5;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .button-group {
    display: flex;
    gap: 10px;
    margin: 20px 0;
  }

  button {
    background-color: #0e639c;
    color: #ffffff;
    border: none;
    padding: 10px 20px;
    font-size: 16px;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s;
  }

  button:hover {
    background-color: #1177bb;
  }

  button:active {
    background-color: #0d5a8f;
  }

  button:disabled {
    background-color: #555555;
    cursor: not-allowed;
  }

  .status {
    margin-top: 10px;
    padding: 10px;
    border-radius: 4px;
    font-size: 14px;
    display: none;
  }

  .status.info {
    background-color: #1e3a5f;
    color: #4fc3f7;
    display: block;
  }

  .status.error {
    background-color: #5f1e1e;
    color: #ff6b6b;
    display: block;
  }

  .status.success {
    background-color: #1e5f1e;
    color: #6bff6b;
    display: block;
  }

  textarea {
    background-color: #1e1e1e;
    color: #d4d4d4;
    border: 1px solid #3c3c3c;
    padding: 10px;
    font-family: 'Consolas', 'Monaco', monospace;
    font-size: 14px;
    border-radius: 4px;
  }

  textarea:focus {
    outline: none;
    border-color: #4fc3f7;
  }

  h2, h3 {
    color: #4fc3f7;
    margin-top: 30px;
  }

  .info-box {
    background-color: #1e3a5f;
    border-left: 4px solid #4fc3f7;
    padding: 10px 15px;
    margin: 15px 0;
    border-radius: 4px;
    font-size: 13px;
    color: #b0b0b0;
  }

  .example-code {
    background-color: #0d0d0d;
    border: 1px solid #3c3c3c;
    padding: 10px;
    border-radius: 4px;
    margin: 10px 0;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.3s;
  }

  .example-code:hover {
    border-color: #4fc3f7;
    background-color: #1a1a1a;
  }

  .examples {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 10px;
    margin: 15px 0;
  }
</style>
</head>
<body>
<header>
  ë¸Œë¼ìš°ì €ì—ì„œ C ì½”ë“œ ì‹¤í–‰
  <div class="user-info">
    <span id="username">ì‚¬ìš©ì</span>
    <button class="logout-btn" onclick="handleLogout()">ë¡œê·¸ì•„ì›ƒ</button>
  </div>
</header>

<nav>
  <a href="index.html">ë©”ì¸</a>
  <a href="editor.html">ì‹¤ìŠµ</a>
</nav>

<div class="container">
  <!-- ì¶œì„ ì²´í¬ ëŒ€ì‹œë³´ë“œ -->
  <div class="attendance-dashboard">
    <div class="attendance-header">
      <h3>ğŸ“‹ ì¶œì„ í˜„í™©</h3>
      <button class="check-in-btn" id="checkInBtn" onclick="checkAttendance()">âœ“ ì¶œì„ ì²´í¬</button>
    </div>

    <div id="checkInMessage" class="check-in-message"></div>

    <div class="attendance-stats">
      <div class="stat-card">
        <div class="stat-label">ì´ ì°¸ì„ ì¼ìˆ˜</div>
        <div class="stat-value" id="totalDays">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">ì´ë²ˆ ë‹¬</div>
        <div class="stat-value" id="monthDays">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">ìµœê·¼ ì¶œì„</div>
        <div class="stat-value" id="lastCheckIn">-</div>
      </div>
    </div>

    <div class="attendance-history">
      <h4>ğŸ“… ì¶œì„ ê¸°ë¡</h4>
      <div id="attendanceList"></div>
    </div>
  </div>

  <h2>C ì½”ë“œ ì…ë ¥</h2>
  <div class="info-box">
    ğŸ’¡ C ì½”ë“œë¥¼ ì…ë ¥í•˜ê³  "â–¶ ì‹¤í–‰" ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  </div>
  
  <textarea id="code" placeholder="C ì½”ë“œë¥¼ ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”...">#include <stdio.h>

int main() {
    printf("Hello from C!\n");
    return 0;
}</textarea>
  
  <div class="button-group">
    <button id="runBtn" onclick="runCode()">â–¶ ì‹¤í–‰</button>
    <button id="clearBtn" onclick="clearCode()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
  </div>

  <div id="status" class="status"></div>

  <h3>ì‹¤í–‰ ê²°ê³¼</h3>
  <pre id="output">ì‹¤í–‰ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.</pre>

  <h3>ğŸ“š ì˜ˆì œ ì½”ë“œ</h3>
  <div class="examples">
    <div class="example-code" onclick="loadExample(0)">
      <strong>Hello World</strong><br>
      ê°„ë‹¨í•œ ì¶œë ¥ ì˜ˆì œ
    </div>
    <div class="example-code" onclick="loadExample(1)">
      <strong>ë§ì…ˆ</strong><br>
      ë‘ ìˆ˜ì˜ í•© ê³„ì‚°
    </div>
    <div class="example-code" onclick="loadExample(2)">
      <strong>ë°˜ë³µë¬¸</strong><br>
      1ë¶€í„° 5ê¹Œì§€ ì¶œë ¥
    </div>
    <div class="example-code" onclick="loadExample(3)">
      <strong>ë°°ì—´</strong><br>
      ë°°ì—´ ìš”ì†Œ ì¶œë ¥
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
import { getFirestore, collection, addDoc, query, where, getDocs, orderBy } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBpXt13oLYfr4SzA5EtYRcjddvZCRTuUSI",
  authDomain: "code-quest-4918e.firebaseapp.com",
  projectId: "code-quest-4918e",
  storageBucket: "code-quest-4918e.firebasestorage.app",
  messagingSenderId: "22281251552",
  appId: "1:22281251552:web:3cfb4d84d3313949243e85",
  measurementId: "G-94FKSPBZ2S"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser = null;

// ì¸ì¦ ìƒíƒœ ëª¨ë‹ˆí„°ë§
onAuthStateChanged(auth, async (user) => {
  if (user) {
    currentUser = user;
    document.getElementById('username').textContent = user.email;
    await updateAttendanceUI(user.uid);
    document.getElementById('code').focus();
  } else {
    window.location.href = 'login.html';
  }
});

// ì¶œì„ ì²´í¬ í•¨ìˆ˜
window.checkAttendance = async function() {
  if (!currentUser) return;

  const today = new Date().toISOString().split('T')[0];
  const checkInBtn = document.getElementById('checkInBtn');
  const messageEl = document.getElementById('checkInMessage');

  try {
    // ì˜¤ëŠ˜ ì´ë¯¸ ì¶œì„í–ˆëŠ”ì§€ í™•ì¸
    const q = query(
      collection(db, 'attendance'),
      where('userId', '==', currentUser.uid),
      where('date', '==', today)
    );
    const querySnapshot = await getDocs(q);

    if (!querySnapshot.empty) {
      messageEl.className = 'check-in-message info';
      messageEl.textContent = 'âœ“ ì˜¤ëŠ˜ ì´ë¯¸ ì¶œì„í–ˆìŠµë‹ˆë‹¤!';
      checkInBtn.disabled = true;
      return;
    }

    // ìƒˆë¡œìš´ ì¶œì„ ê¸°ë¡ ì¶”ê°€
    await addDoc(collection(db, 'attendance'), {
      userId: currentUser.uid,
      email: currentUser.email,
      date: today,
      timestamp: new Date()
    });

    messageEl.className = 'check-in-message success';
    messageEl.textContent = 'âœ“ ì¶œì„ ì™„ë£Œ!';
    checkInBtn.disabled = true;

    // UI ì—…ë°ì´íŠ¸
    await updateAttendanceUI(currentUser.uid);
  } catch (error) {
    console.error('ì¶œì„ ì²´í¬ ì˜¤ë¥˜:', error);
    messageEl.className = 'check-in-message error';
    messageEl.textContent = 'âŒ ì¶œì„ ì²´í¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
  }
};

// ì¶œì„ í˜„í™© UI ì—…ë°ì´íŠ¸
async function updateAttendanceUI(userId) {
  try {
    const today = new Date().toISOString().split('T')[0];
    const currentMonth = new Date().toISOString().slice(0, 7);

    // ëª¨ë“  ì¶œì„ ê¸°ë¡ ì¡°íšŒ
    const q = query(
      collection(db, 'attendance'),
      where('userId', '==', userId),
      orderBy('date', 'desc')
    );
    const querySnapshot = await getDocs(q);

    const dates = [];
    querySnapshot.forEach((doc) => {
      dates.push(doc.data().date);
    });

    // ì´ ì°¸ì„ ì¼ìˆ˜
    document.getElementById('totalDays').textContent = dates.length;

    // ì´ë²ˆ ë‹¬ ì°¸ì„ ì¼ìˆ˜
    const monthDays = dates.filter(date => date.startsWith(currentMonth)).length;
    document.getElementById('monthDays').textContent = monthDays;

    // ìµœê·¼ ì¶œì„ ë‚ ì§œ
    if (dates.length > 0) {
      const lastDate = new Date(dates[0]);
      document.getElementById('lastCheckIn').textContent = lastDate.toLocaleDateString('ko-KR');
    }

    // ì¶œì„ ê¸°ë¡ ëª©ë¡
    const attendanceList = document.getElementById('attendanceList');
    attendanceList.innerHTML = '';

    if (dates.length === 0) {
      attendanceList.innerHTML = '<div class="attendance-item">ì•„ì§ ì¶œì„ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
    } else {
      const recentDates = dates.slice(0, 10);
      recentDates.forEach(date => {
        const dateObj = new Date(date);
        const formattedDate = dateObj.toLocaleDateString('ko-KR', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          weekday: 'short'
        });
        
        const item = document.createElement('div');
        item.className = 'attendance-item';
        item.innerHTML = `<span class="date">${formattedDate}</span><span class="status">âœ“</span>`;
        attendanceList.appendChild(item);
      });
    }

    // ì˜¤ëŠ˜ ì´ë¯¸ ì¶œì„í–ˆìœ¼ë©´ ë²„íŠ¼ ë¹„í™œì„±í™”
    const checkInBtn = document.getElementById('checkInBtn');
    if (dates.includes(today)) {
      checkInBtn.disabled = true;
    } else {
      checkInBtn.disabled = false;
    }
  } catch (error) {
    console.error('ì¶œì„ í˜„í™© ì¡°íšŒ ì˜¤ë¥˜:', error);
  }
}

// ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
window.handleLogout = async function() {
  if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
    try {
      await signOut(auth);
      window.location.href = 'login.html';
    } catch (error) {
      console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
    }
  }
};

// ì˜ˆì œ ì½”ë“œ ëª¨ìŒ
const examples = [
  {
    name: "Hello World",
    code: `#include <stdio.h>

int main() {
    printf("Hello, World!\\n");
    return 0;
}`
  },
  {
    name: "ë§ì…ˆ",
    code: `#include <stdio.h>

int main() {
    int a = 10, b = 20;
    printf("a + b = %d\\n", a + b);
    return 0;
}`
  },
  {
    name: "ë°˜ë³µë¬¸",
    code: `#include <stdio.h>

int main() {
    for (int i = 1; i <= 5; i++) {
        printf("%d\\n", i);
    }
    return 0;
}`
  },
  {
    name: "ë°°ì—´",
    code: `#include <stdio.h>

int main() {
    int arr[] = {1, 2, 3, 4, 5};
    for (int i = 0; i < 5; i++) {
        printf("arr[%d] = %d\\n", i, arr[i]);
    }
    return 0;
}`
  }
];

// ì˜ˆì œ ì½”ë“œ ë¡œë“œ
window.loadExample = function(index) {
  document.getElementById('code').value = examples[index].code;
  document.getElementById('output').textContent = 'ì˜ˆì œê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. ì‹¤í–‰ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.';
  document.getElementById('code').focus();
};

// ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
function showStatus(message, type = 'info') {
  const statusEl = document.getElementById('status');
  statusEl.textContent = message;
  statusEl.className = `status ${type}`;
  
  if (type === 'success' || type === 'error') {
    setTimeout(() => {
      statusEl.className = 'status';
    }, 3000);
  }
}

// JDoodle APIë¥¼ ì‚¬ìš©í•œ ì½”ë“œ ì‹¤í–‰
window.runCode = async function() {
  const code = document.getElementById('code').value;
  const output = document.getElementById('output');
  const runBtn = document.getElementById('runBtn');

  if (!code.trim()) {
    showStatus('âŒ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
    return;
  }

  runBtn.disabled = true;
  output.textContent = 'â³ ì½”ë“œ ì‹¤í–‰ ì¤‘...\n\n(ì„œë²„ì—ì„œ ì»´íŒŒì¼ ì¤‘ì…ë‹ˆë‹¤...)';
  showStatus('â³ ì½”ë“œë¥¼ ì„œë²„ì— ì „ì†¡í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');

  try {
    const jdoodleResponse = await fetch('https://api.jdoodle.com/v1/execute', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        'clientId': '2e3c5f6e3f8c8d8e8f8g8h8i8j8k8l8m',
        'clientSecret': '8f8c8d8e8f8g8h8i8j8k8l8m8n8o8p8q8r8s8t8u',
        'script': code,
        'language': 'c',
        'versionIndex': '0'
      })
    });

    if (!jdoodleResponse.ok) {
      throw new Error(`HTTP error! status: ${jdoodleResponse.status}`);
    }

    const result = await jdoodleResponse.json();

    if (result.error) {
      showStatus(`âŒ ì˜¤ë¥˜: ${result.error}`, 'error');
      output.textContent = `âŒ ì»´íŒŒì¼ ì˜¤ë¥˜:\n${result.error}`;
      return;
    }

    let resultText = '';

    if (result.output) {
      resultText = 'ğŸ“¤ í‘œì¤€ ì¶œë ¥:\n' + result.output;
    }

    if (result.statusCode !== 0) {
      if (resultText) resultText += '\n\n';
      resultText += `âš ï¸ ì‹¤í–‰ ìƒíƒœ ì½”ë“œ: ${result.statusCode}`;
    }

    if (!result.output && result.statusCode === 0) {
      resultText = 'âœ… ì½”ë“œê°€ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.\n(ì¶œë ¥ ì—†ìŒ)';
    }

    output.textContent = resultText || 'âœ… ì‹¤í–‰ ì™„ë£Œ';
    showStatus('âœ… ì½”ë“œ ì‹¤í–‰ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');

  } catch (error) {
    showStatus(`âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
    output.textContent = `âŒ ì˜¤ë¥˜ ë°œìƒ:\n${error.message}\n\níŒ: ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`;
  } finally {
    runBtn.disabled = false;
  }
};

// ì½”ë“œ ì´ˆê¸°í™” í•¨ìˆ˜
window.clearCode = function() {
  if (confirm('ì½”ë“œë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
    document.getElementById('code').value = '#include <stdio.h>\n\nint main() {\n    printf("Hello from C!\\n");\n    return 0;\n}';
    document.getElementById('output').textContent = 'ì‹¤í–‰ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.';
    document.getElementById('status').className = 'status';
  }
};
</script>
</body>
</html>
