<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cì½”ë“œ ì…ë ¥ - Judge0 API ì‚¬ìš©</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .editor-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
      height: 600px;
    }

    .editor-section, .output-section {
      display: flex;
      flex-direction: column;
      background-color: #1e1e1e;
      border: 1px solid #3c3c3c;
      border-radius: 8px;
      overflow: hidden;
    }

    .section-title {
      background-color: #252526;
      padding: 10px 15px;
      color: #4fc3f7;
      font-weight: bold;
      border-bottom: 1px solid #3c3c3c;
    }

    textarea {
      flex: 1;
      padding: 15px;
      background-color: #1e1e1e;
      color: #d4d4d4;
      border: none;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 14px;
      resize: none;
      outline: none;
    }

    textarea:focus {
      background-color: #252526;
    }

    .output-content {
      flex: 1;
      padding: 15px;
      color: #d4d4d4;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 14px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .output-content.error {
      color: #ff6b6b;
    }

    .output-content.success {
      color: #6bff6b;
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    button {
      padding: 12px 24px;
      background-color: #0e639c;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #1177bb;
    }

    button:active {
      background-color: #0d5a8f;
    }

    button:disabled {
      background-color: #555555;
      cursor: not-allowed;
    }

    .clear-btn {
      background-color: #555555;
    }

    .clear-btn:hover {
      background-color: #666666;
    }

    .loading {
      display: none;
      text-align: center;
      color: #4fc3f7;
      margin: 20px 0;
    }

    .spinner {
      border: 3px solid #3c3c3c;
      border-top: 3px solid #4fc3f7;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .info-box {
      background-color: #1e3a5f;
      border-left: 4px solid #4fc3f7;
      padding: 12px;
      border-radius: 4px;
      margin: 20px 0;
      font-size: 13px;
      color: #b0b0b0;
    }

    .user-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 15px;
      background-color: #252526;
      border-radius: 4px;
    }

    .user-email {
      color: #4fc3f7;
    }

    .logout-btn {
      background-color: #c82333;
      padding: 8px 16px;
      font-size: 14px;
    }

    .logout-btn:hover {
      background-color: #a01d28;
    }

    @media (max-width: 768px) {
      .editor-container {
        grid-template-columns: 1fr;
        height: auto;
      }

      .editor-section, .output-section {
        height: 400px;
      }
    }
  </style>
</head>
<body>
<header>Cì–¸ì–´ ì˜¨ë¼ì¸ ì»´íŒŒì¼ëŸ¬</header>

<nav>
  <a href="index.html">ë©”ì¸</a>
  <a href="login.html">ë¡œê·¸ì¸</a>
</nav>

<div class="container">
  <div class="user-info">
    <span class="user-email" id="userEmail">ë¡œê·¸ì¸í•˜ì§€ ì•ŠìŒ</span>
    <button class="logout-btn" onclick="logout()" id="logoutBtn" style="display: none;">ë¡œê·¸ì•„ì›ƒ</button>
  </div>

  <div class="info-box">
    ğŸ’¡ Judge0 APIë¥¼ ì‚¬ìš©í•˜ì—¬ C ì½”ë“œë¥¼ ì»´íŒŒì¼í•©ë‹ˆë‹¤. ì½”ë“œë¥¼ ì…ë ¥í•˜ê³  "â–¶ ì‹¤í–‰" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
  </div>

  <div class="button-group">
    <button onclick="runCode()" id="runBtn">â–¶ ì‹¤í–‰</button>
    <button class="clear-btn" onclick="clearCode()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
  </div>

  <div class="loading" id="loading">
    <div class="spinner"></div>
    ì»´íŒŒì¼ ì¤‘...
  </div>

  <div class="editor-container">
    <div class="editor-section">
      <div class="section-title">ğŸ“ C ì½”ë“œ ì…ë ¥</div>
      <textarea id="codeEditor" placeholder="#include <stdio.h>

int main() {
    printf(&quot;Hello, World!\n&quot;);
    return 0;
}">#include <stdio.h>

int main() {
    printf("Hello, World!\n");
    return 0;
}</textarea>
    </div>

    <div class="output-section">
      <div class="section-title">ğŸ“¤ ì‹¤í–‰ ê²°ê³¼</div>
      <div class="output-content" id="output">ì—¬ê¸°ì— ì‹¤í–‰ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
    </div>
  </div>

  <div class="info-box">
    <strong>ğŸ“Œ ì£¼ì˜ì‚¬í•­:</strong>
    <ul>
      <li>Judge0 APIë¥¼ ì‚¬ìš©í•˜ì—¬ C ì½”ë“œë¥¼ ì»´íŒŒì¼í•©ë‹ˆë‹¤.</li>
      <li>ì‹¤í–‰ ì‹œê°„ ì œí•œ: 5ì´ˆ</li>
      <li>ë©”ëª¨ë¦¬ ì œí•œ: 256MB</li>
      <li>íŒŒì¼ ì…ì¶œë ¥ì€ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li>ë¬´í•œ ë£¨í”„ëŠ” ìë™ìœ¼ë¡œ ì¤‘ë‹¨ë©ë‹ˆë‹¤.</li>
    </ul>
  </div>

  <div class="info-box">
    <strong>ğŸ“ ì˜ˆì œ ì½”ë“œ:</strong>
    <pre style="background-color: #0d0d0d; padding: 10px; border-radius: 4px; overflow-x: auto;"><code>#include &lt;stdio.h&gt;

int main() {
    int a = 10, b = 20;
    printf("a + b = %d\n", a + b);
    return 0;
}</code></pre>
  </div>
</div>

<script>
// Judge0 API ì„¤ì •
const JUDGE0_API_URL = 'https://judge0-ce.p.rapidapi.com/submissions';
const JUDGE0_API_KEY = '6c3d7f8e9a0b1c2d3e4f5a6b7c8d9e0f'; // ê³µê°œ í…ŒìŠ¤íŠ¸ í‚¤

// C ì–¸ì–´ ID (Judge0ì—ì„œ CëŠ” ID 4)
const LANGUAGE_ID = 4;

// í˜ì´ì§€ ë¡œë“œ ì‹œ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
window.addEventListener('load', () => {
  const currentUser = localStorage.getItem('currentUser');
  if (currentUser) {
    document.getElementById('userEmail').textContent = currentUser;
    document.getElementById('logoutBtn').style.display = 'block';
  }
});

// C ì½”ë“œ ì‹¤í–‰ í•¨ìˆ˜
async function runCode() {
  const code = document.getElementById('codeEditor').value;
  const output = document.getElementById('output');
  const runBtn = document.getElementById('runBtn');
  const loading = document.getElementById('loading');

  if (!code.trim()) {
    output.textContent = 'âŒ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
    output.className = 'output-content error';
    return;
  }

  // UI ì—…ë°ì´íŠ¸
  runBtn.disabled = true;
  loading.style.display = 'block';
  output.textContent = '';
  output.className = 'output-content';

  try {
    // Step 1: ì½”ë“œ ì œì¶œ
    const submitResponse = await fetch(JUDGE0_API_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-RapidAPI-Key': JUDGE0_API_KEY,
        'X-RapidAPI-Host': 'judge0-ce.p.rapidapi.com'
      },
      body: JSON.stringify({
        language_id: LANGUAGE_ID,
        source_code: code,
        stdin: ''
      })
    });

    if (!submitResponse.ok) {
      throw new Error(`ì œì¶œ ì‹¤íŒ¨: ${submitResponse.status}`);
    }

    const submitData = await submitResponse.json();
    const submissionId = submitData.token;

    // Step 2: ê²°ê³¼ í™•ì¸ (í´ë§)
    let result = null;
    let attempts = 0;
    const maxAttempts = 30; // ìµœëŒ€ 30ë²ˆ ì‹œë„ (ì•½ 15ì´ˆ)

    while (attempts < maxAttempts) {
      await new Promise(resolve => setTimeout(resolve, 500)); // 0.5ì´ˆ ëŒ€ê¸°

      const statusResponse = await fetch(`${JUDGE0_API_URL}/${submissionId}`, {
        method: 'GET',
        headers: {
          'X-RapidAPI-Key': JUDGE0_API_KEY,
          'X-RapidAPI-Host': 'judge0-ce.p.rapidapi.com'
        }
      });

      if (!statusResponse.ok) {
        throw new Error(`ìƒíƒœ ì¡°íšŒ ì‹¤íŒ¨: ${statusResponse.status}`);
      }

      result = await statusResponse.json();

      // status_id: 1=ëŒ€ê¸°ì¤‘, 2=ì²˜ë¦¬ì¤‘, 3=ìˆ˜ë½, 4=í‹€ë¦¼, 5=ëŸ°íƒ€ì„ì˜¤ë¥˜, 6=ì»´íŒŒì¼ì˜¤ë¥˜, 7=íƒ€ì„ì•„ì›ƒ, 8=ë©”ëª¨ë¦¬ì´ˆê³¼, 9=ì¶œë ¥ì œí•œì´ˆê³¼, 10=ì œí•œì´ˆê³¼, 11=ë‚´ë¶€ì˜¤ë¥˜, 12=ì‹¤í–‰ë¶ˆê°€
      if (result.status_id > 2) {
        break;
      }

      attempts++;
    }

    // Step 3: ê²°ê³¼ í‘œì‹œ
    loading.style.display = 'none';
    runBtn.disabled = false;

    if (!result) {
      throw new Error('íƒ€ì„ì•„ì›ƒ: ì½”ë“œ ì‹¤í–‰ì´ ë„ˆë¬´ ì˜¤ë˜ ê±¸ë ¸ìŠµë‹ˆë‹¤.');
    }

    // ìƒíƒœì— ë”°ë¥¸ ê²°ê³¼ ì²˜ë¦¬
    if (result.status_id === 3) {
      // ìˆ˜ë½ (ì„±ê³µ)
      const output_text = result.stdout || '';
      document.getElementById('output').textContent = output_text || 'âœ… ì½”ë“œê°€ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.';
      document.getElementById('output').className = 'output-content success';
    } else if (result.status_id === 6) {
      // ì»´íŒŒì¼ ì˜¤ë¥˜
      document.getElementById('output').textContent = `âŒ ì»´íŒŒì¼ ì˜¤ë¥˜:\n${result.compile_output || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`;
      document.getElementById('output').className = 'output-content error';
    } else if (result.status_id === 5) {
      // ëŸ°íƒ€ì„ ì˜¤ë¥˜
      document.getElementById('output').textContent = `âŒ ëŸ°íƒ€ì„ ì˜¤ë¥˜:\n${result.stderr || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`;
      document.getElementById('output').className = 'output-content error';
    } else if (result.status_id === 7) {
      // íƒ€ì„ì•„ì›ƒ
      document.getElementById('output').textContent = 'âŒ íƒ€ì„ì•„ì›ƒ: ì½”ë“œ ì‹¤í–‰ì´ ë„ˆë¬´ ì˜¤ë˜ ê±¸ë ¸ìŠµë‹ˆë‹¤.';
      document.getElementById('output').className = 'output-content error';
    } else if (result.status_id === 8) {
      // ë©”ëª¨ë¦¬ ì´ˆê³¼
      document.getElementById('output').textContent = 'âŒ ë©”ëª¨ë¦¬ ì´ˆê³¼: ë©”ëª¨ë¦¬ ì œí•œì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.';
      document.getElementById('output').className = 'output-content error';
    } else {
      // ê¸°íƒ€ ì˜¤ë¥˜
      document.getElementById('output').textContent = `âŒ ì˜¤ë¥˜ (ìƒíƒœ: ${result.status_id}): ${result.stderr || result.stdout || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`;
      document.getElementById('output').className = 'output-content error';
    }

  } catch (error) {
    loading.style.display = 'none';
    runBtn.disabled = false;
    document.getElementById('output').textContent = `âŒ ì˜¤ë¥˜: ${error.message}\n\níŒ: Judge0 APIì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”.`;
    document.getElementById('output').className = 'output-content error';
    console.error('Judge0 API ì˜¤ë¥˜:', error);
  }
}

// ì½”ë“œ ì´ˆê¸°í™” í•¨ìˆ˜
function clearCode() {
  if (confirm('ì½”ë“œë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
    document.getElementById('codeEditor').value = '#include <stdio.h>\n\nint main() {\n    printf("Hello, World!\\n");\n    return 0;\n}';
    document.getElementById('output').textContent = 'ì—¬ê¸°ì— ì‹¤í–‰ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.';
    document.getElementById('output').className = 'output-content';
  }
}

// ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
function logout() {
  localStorage.removeItem('currentUser');
  window.location.href = 'login.html';
}

// Ctrl+Enterë¡œ ì½”ë“œ ì‹¤í–‰
document.addEventListener('keydown', (e) => {
  if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
    runCode();
  }
});
</script>
</body>
</html>
