<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cì–¸ì–´ ì˜¨ë¼ì¸ ì»´íŒŒì¼ëŸ¬</title>
<link rel="stylesheet" href="styles.css">
<style>
  #output {
    background-color: #0d0d0d;
    border: 1px solid #3c3c3c;
    padding: 15px;
    border-radius: 4px;
    min-height: 150px;
    max-height: 400px;
    overflow-y: auto;
    font-size: 14px;
    line-height: 1.5;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .button-group {
    display: flex;
    gap: 10px;
    margin: 20px 0;
  }

  button {
    background-color: #0e639c;
    color: #ffffff;
    border: none;
    padding: 10px 20px;
    font-size: 16px;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s;
  }

  button:hover {
    background-color: #1177bb;
  }

  button:active {
    background-color: #0d5a8f;
  }

  button:disabled {
    background-color: #555555;
    cursor: not-allowed;
  }

  .status {
    margin-top: 10px;
    padding: 10px;
    border-radius: 4px;
    font-size: 14px;
    display: none;
  }

  .status.info {
    background-color: #1e3a5f;
    color: #4fc3f7;
    display: block;
  }

  .status.error {
    background-color: #5f1e1e;
    color: #ff6b6b;
    display: block;
  }

  .status.success {
    background-color: #1e5f1e;
    color: #6bff6b;
    display: block;
  }

  textarea {
    background-color: #1e1e1e;
    color: #d4d4d4;
    border: 1px solid #3c3c3c;
    padding: 10px;
    font-family: 'Consolas', 'Monaco', monospace;
    font-size: 14px;
    border-radius: 4px;
  }

  textarea:focus {
    outline: none;
    border-color: #4fc3f7;
  }

  h2, h3 {
    color: #4fc3f7;
    margin-top: 30px;
  }

  .info-box {
    background-color: #1e3a5f;
    border-left: 4px solid #4fc3f7;
    padding: 10px 15px;
    margin: 15px 0;
    border-radius: 4px;
    font-size: 13px;
    color: #b0b0b0;
  }
</style>
</head>
<body>
<header>ë¸Œë¼ìš°ì €ì—ì„œ C ì½”ë“œ ì‹¤í–‰</header>

<nav>
  <a href="index.html">ë©”ì¸</a>
  <a href="editor.html">ì‹¤ìŠµ</a>
</nav>

<div class="container">
  <h2>C ì½”ë“œ ì…ë ¥</h2>
  <div class="info-box">
    ğŸ’¡ C ì½”ë“œë¥¼ ì…ë ¥í•˜ê³  "â–¶ ì‹¤í–‰" ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  </div>
  
  <textarea id="code" placeholder="C ì½”ë“œë¥¼ ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”...">#include <stdio.h>

int main() {
    printf("Hello from C!\n");
    return 0;
}</textarea>
  
  <div class="button-group">
    <button id="runBtn" onclick="runCode()">â–¶ ì‹¤í–‰</button>
    <button id="clearBtn" onclick="clearCode()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
  </div>

  <div id="status" class="status"></div>

  <h3>ì‹¤í–‰ ê²°ê³¼</h3>
  <pre id="output">ì‹¤í–‰ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.</pre>
</div>

<script>
// Paiza API ì„¤ì •
const PAIZA_API_KEY = 'guest'; // ê³µê°œ API í‚¤ (ì œí•œëœ ê¸°ëŠ¥)
const PAIZA_API_URL = 'https://api.paiza.io/api/v1/runners/create';

// ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
function showStatus(message, type = 'info') {
  const statusEl = document.getElementById('status');
  statusEl.textContent = message;
  statusEl.className = `status ${type}`;
  
  if (type === 'success' || type === 'error') {
    setTimeout(() => {
      statusEl.className = 'status';
    }, 3000);
  }
}

// ì½”ë“œ ì‹¤í–‰ í•¨ìˆ˜
async function runCode() {
  const code = document.getElementById('code').value;
  const output = document.getElementById('output');
  const runBtn = document.getElementById('runBtn');

  if (!code.trim()) {
    showStatus('âŒ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
    return;
  }

  // UI ì—…ë°ì´íŠ¸
  runBtn.disabled = true;
  output.textContent = 'â³ ì½”ë“œ ì‹¤í–‰ ì¤‘...\n\n(ì„œë²„ì—ì„œ ì»´íŒŒì¼ ì¤‘ì…ë‹ˆë‹¤...)';
  showStatus('â³ ì½”ë“œë¥¼ ì„œë²„ì— ì „ì†¡í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');

  try {
    // Paiza APIë¥¼ ì‚¬ìš©í•œ C ì½”ë“œ ì»´íŒŒì¼
    const response = await fetch(PAIZA_API_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: new URLSearchParams({
        'language': 'c',
        'source_code': code,
        'api_key': PAIZA_API_KEY,
      }),
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const data = await response.json();

    if (data.error) {
      showStatus(`âŒ ì˜¤ë¥˜: ${data.error}`, 'error');
      output.textContent = `âŒ ì»´íŒŒì¼ ì˜¤ë¥˜:\n${data.error}`;
      return;
    }

    const executionId = data.id;

    // ì‹¤í–‰ ê²°ê³¼ ì¡°íšŒ (í´ë§)
    let attempts = 0;
    const maxAttempts = 30; // ìµœëŒ€ 30ì´ˆ ëŒ€ê¸°

    const checkResult = async () => {
      attempts++;

      const statusResponse = await fetch(
        `https://api.paiza.io/api/v1/runners/get_status?id=${executionId}&api_key=${PAIZA_API_KEY}`
      );

      const statusData = await statusResponse.json();

      if (statusData.status === 'completed') {
        // ê²°ê³¼ ì¶œë ¥
        let resultText = '';

        if (statusData.stdout) {
          resultText += 'ğŸ“¤ í‘œì¤€ ì¶œë ¥:\n' + statusData.stdout;
        }

        if (statusData.stderr) {
          if (resultText) resultText += '\n\n';
          resultText += 'âš ï¸ ì˜¤ë¥˜ ì¶œë ¥:\n' + statusData.stderr;
        }

        if (!statusData.stdout && !statusData.stderr) {
          resultText = 'âœ… ì½”ë“œê°€ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.\n(ì¶œë ¥ ì—†ìŒ)';
        }

        output.textContent = resultText;
        showStatus('âœ… ì½”ë“œ ì‹¤í–‰ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        return;
      } else if (statusData.status === 'running') {
        output.textContent = `â³ ì½”ë“œ ì‹¤í–‰ ì¤‘...\n\n(${attempts}ì´ˆ ê²½ê³¼)`;

        if (attempts < maxAttempts) {
          setTimeout(checkResult, 1000);
        } else {
          showStatus('âŒ ì‹¤í–‰ ì‹œê°„ ì´ˆê³¼ (30ì´ˆ ì´ìƒ)', 'error');
          output.textContent = 'âŒ ì‹¤í–‰ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.\nì½”ë“œë¥¼ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
        }
      } else if (statusData.status === 'failed') {
        showStatus('âŒ ì½”ë“œ ì‹¤í–‰ ì‹¤íŒ¨', 'error');
        output.textContent = `âŒ ì‹¤í–‰ ì‹¤íŒ¨:\n${statusData.stderr || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`;
      }
    };

    // ì²« ë²ˆì§¸ ìƒíƒœ í™•ì¸
    setTimeout(checkResult, 500);

  } catch (error) {
    showStatus(`âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
    output.textContent = `âŒ ì˜¤ë¥˜ ë°œìƒ:\n${error.message}\n\níŒ: ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`;
  } finally {
    runBtn.disabled = false;
  }
}

// ì½”ë“œ ì´ˆê¸°í™” í•¨ìˆ˜
function clearCode() {
  if (confirm('ì½”ë“œë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
    document.getElementById('code').value = '#include <stdio.h>\n\nint main() {\n    printf("Hello from C!\\n");\n    return 0;\n}';
    document.getElementById('output').textContent = 'ì‹¤í–‰ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.';
    document.getElementById('status').className = 'status';
  }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì½”ë“œ ì˜ì—­ì— í¬ì»¤ìŠ¤
window.addEventListener('load', () => {
  document.getElementById('code').focus();
});
</script>
</body>
</html>
